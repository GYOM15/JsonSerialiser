<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CalculateMinHoursByOrderCategoryConditions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">inf2050-a24-projet-equipe6</a> &gt; <a href="index.source.html" class="el_package">GROUPE6_INF2050.Validators.HoursCalculators</a> &gt; <span class="el_source">CalculateMinHoursByOrderCategoryConditions.java</span></div><h1>CalculateMinHoursByOrderCategoryConditions.java</h1><pre class="source lang-java linenums">package GROUPE6_INF2050.Validators.HoursCalculators;

import GROUPE6_INF2050.Enums.ActivityCategory;
import GROUPE6_INF2050.Enums.ActivityOrder;
import GROUPE6_INF2050.Utilities.JsonFileUtility;
import GROUPE6_INF2050.Handlers.ErrorHandler;
import GROUPE6_INF2050.Validators.Generics.ActivityFilter.ActivityJsonBuilderByCategoriesConditions;

import GROUPE6_INF2050.Validators.Generics.Calculator.ActivityHoursCalculator;
import net.sf.json.JSONArray;
import net.sf.json.JSONObject;

import java.util.List;
import java.util.stream.Collectors;

<span class="nc" id="L16">public class CalculateMinHoursByOrderCategoryConditions {</span>

<span class="fc" id="L18">    private static final List&lt;String&gt; architectCategories = List.of(</span>
<span class="fc" id="L19">            ActivityCategory.COURS.getCategoryFromJsonObj(),</span>
<span class="fc" id="L20">            ActivityCategory.ATELIER.getCategoryFromJsonObj(),</span>
<span class="fc" id="L21">            ActivityCategory.SEMINAIRE.getCategoryFromJsonObj(),</span>
<span class="fc" id="L22">            ActivityCategory.COLLOQUE.getCategoryFromJsonObj(),</span>
<span class="fc" id="L23">            ActivityCategory.CONFERENCE.getCategoryFromJsonObj(),</span>
<span class="fc" id="L24">            ActivityCategory.LECTURE_DIRIGEE.getCategoryFromJsonObj()</span>
    );

    public static int validateMinimumHours(JsonFileUtility obj, ActivityOrder order, ErrorHandler errorHandler) {
<span class="pc bpc" id="L28" title="1 of 4 branches missed.">        switch (order) {</span>
<span class="fc" id="L29">            case GEOLOGUES, PODIATRES -&gt; validateGeologueAndPodiatreHours(obj, errorHandler);</span>
<span class="fc" id="L30">            case ARCHITECTES -&gt; validateArchitecteHours(obj, errorHandler);</span>
<span class="fc" id="L31">            case PSYCHOLOGUES -&gt; validatePsychologueHours(obj, errorHandler);</span>
        }
<span class="fc" id="L33">        return 0;</span>
    }

    private static void validateGeologueAndPodiatreHours(JsonFileUtility obj, ErrorHandler errorHandler) {
<span class="fc" id="L37">        validateCategories(obj, errorHandler, List.of(</span>
<span class="fc" id="L38">                new CategoryRequirement(ActivityCategory.COURS.getCategoryFromJsonObj(), 22),</span>
<span class="fc" id="L39">                new CategoryRequirement(ActivityCategory.PROJET_DE_RECHERCHE.getCategoryFromJsonObj(), 3),</span>
<span class="fc" id="L40">                new CategoryRequirement(ActivityCategory.GROUPE_DE_DISCUSSION.getCategoryFromJsonObj(), 1)</span>

        ));
<span class="fc" id="L43">    }</span>

    private static void validateArchitecteHours(JsonFileUtility obj, ErrorHandler errorHandler) {
<span class="fc" id="L46">        int totalHours = validateCategories(obj, errorHandler, architectCategories.stream()</span>
<span class="fc" id="L47">                .map(category -&gt; new CategoryRequirement(category, 17))</span>
<span class="fc" id="L48">                .collect(Collectors.toList()));</span>
<span class="fc" id="L49">        handleArchitecteErrors(totalHours, errorHandler);</span>
<span class="fc" id="L50">    }</span>

    private static void validatePsychologueHours(JsonFileUtility obj, ErrorHandler errorHandler) {
<span class="fc" id="L53">        validateCategories(obj, errorHandler, List.of(</span>
<span class="fc" id="L54">                new CategoryRequirement(ActivityCategory.COURS.getCategoryFromJsonObj(), 25)</span>
        ));
<span class="fc" id="L56">    }</span>

    private static void handleArchitecteErrors(int totalHours, ErrorHandler errorHandler) {
<span class="fc bfc" id="L59" title="All 2 branches covered.">        if (totalHours &lt; 17) {</span>
<span class="fc" id="L60">            String categories = String.join(&quot;, &quot;, architectCategories);</span>
<span class="fc" id="L61">            ErrorHandler.addErrorIfNotNull(errorHandler, &quot;Il manque &quot; + (17 - totalHours) +</span>
                    &quot; heures dans les catégories : &quot; + categories + &quot;. Le minimum autorisé est de 17h.&quot;);
        }
<span class="fc" id="L64">    }</span>

    private static int validateCategories(JsonFileUtility obj, ErrorHandler errorHandler, List&lt;CategoryRequirement&gt; requirements) {
<span class="fc" id="L67">        ActivityJsonBuilderByCategoriesConditions builder = new ActivityJsonBuilderByCategoriesConditions();</span>
<span class="fc" id="L68">        List&lt;String&gt; categories = extractCategories(requirements);</span>

<span class="fc" id="L70">        builder.filterByCategorieCondition(obj.getJsonArray(), categories);</span>
<span class="fc" id="L71">        return calculateTotalHours(obj, errorHandler, requirements, builder);</span>
    }

    private static List&lt;String&gt; extractCategories(List&lt;CategoryRequirement&gt; requirements) {
<span class="fc" id="L75">        return requirements.stream()</span>
<span class="fc" id="L76">                .map(CategoryRequirement::category)</span>
<span class="fc" id="L77">                .collect(Collectors.toList());</span>
    }

    private static int calculateTotalHours(JsonFileUtility obj, ErrorHandler errorHandler, List&lt;CategoryRequirement&gt; requirements, ActivityJsonBuilderByCategoriesConditions builder) {
<span class="fc" id="L81">        int totalHours = 0;</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">        for (CategoryRequirement requirement : requirements) {</span>
<span class="fc" id="L83">            JSONArray activities = builder.getActivitiesByCategory(requirement.category());</span>
<span class="fc" id="L84">            JSONObject categoryJsonObject = convertToJsonObject(activities);</span>
<span class="fc" id="L85">            totalHours += processCategory(obj, errorHandler, requirement, categoryJsonObject);</span>
<span class="fc" id="L86">        }</span>
<span class="fc" id="L87">        return totalHours;</span>
    }

    private static int processCategory(JsonFileUtility obj, ErrorHandler errorHandler, CategoryRequirement requirement, JSONObject categoryJsonObject) {
<span class="fc" id="L91">        int actualHours = ActivityHoursCalculator.getTotalHours(categoryJsonObject, errorHandler);</span>
<span class="fc" id="L92">        logMissingHours(obj, errorHandler, requirement, actualHours);</span>
<span class="fc" id="L93">        return actualHours;</span>
    }

    private static void logMissingHours(JsonFileUtility obj, ErrorHandler errorHandler, CategoryRequirement requirement, int actualHours) {
<span class="fc bfc" id="L97" title="All 2 branches covered.">        if (ActivityOrder.searchFromJsonOrder(obj.getJsonObject().getString(&quot;ordre&quot;)) != ActivityOrder.ARCHITECTES){</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">            if (actualHours &lt; requirement.minimumHours()) {</span>
<span class="fc" id="L99">                ErrorHandler.addErrorIfNotNull(errorHandler, &quot;Il manque &quot; + (requirement.minimumHours() - actualHours) +</span>
<span class="fc" id="L100">                        &quot; heures dans la catégorie '&quot; + requirement.category() + &quot;'. Le minimum autorisé est de &quot; + requirement.minimumHours() + &quot;h.&quot;);</span>
            }
        }
<span class="fc" id="L103">    }</span>

    private static JSONObject convertToJsonObject(JSONArray activities) {
<span class="fc" id="L106">        JSONObject jsonObject = new JSONObject();</span>
<span class="fc" id="L107">        jsonObject.put(&quot;activites&quot;, activities);</span>
<span class="fc" id="L108">        return jsonObject;</span>
    }

<span class="fc" id="L111">    private record CategoryRequirement(String category, int minimumHours) {</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>