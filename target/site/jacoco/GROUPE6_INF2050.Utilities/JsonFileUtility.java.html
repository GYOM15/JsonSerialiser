<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JsonFileUtility.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">inf2050-a24-projet-equipe6</a> &gt; <a href="index.source.html" class="el_package">GROUPE6_INF2050.Utilities</a> &gt; <span class="el_source">JsonFileUtility.java</span></div><h1>JsonFileUtility.java</h1><pre class="source lang-java linenums">package GROUPE6_INF2050.Utilities;


import net.sf.json.JSONArray;
import net.sf.json.JSONException;
import net.sf.json.JSONObject;
import net.sf.json.JSONSerializer;
import org.apache.commons.io.IOUtils;
import GROUPE6_INF2050.Exceptions.Groupe6INF2050Exception;
import GROUPE6_INF2050.Handlers.ErrorHandler;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.nio.charset.StandardCharsets;

/**
 * Cette classe est dédiée au traitement du fichier Json
 * */
public class JsonFileUtility extends FileUtility {
    private JSONObject jsonObject;

    public JSONArray getJsonArray() {
<span class="fc" id="L25">        return jsonObject.getJSONArray(&quot;activites&quot;);</span>
    }

    /**
     * Constructeur de la classe JsonFileUtility, hérité de la classe mère FileTreatment.
     * Il initialise les fichiers d'entrée et de sortie, il crée également un object JSON Vide
     *
     * @param inputFile Le fichier d'entrée JSON
     * @param outputFile    Le fichier de sortie JSON où seront affichés les resultats
     */
    public JsonFileUtility(String inputFile, String outputFile) {
<span class="fc" id="L36">        super(inputFile, outputFile);</span>
<span class="fc" id="L37">        this.jsonObject = new JSONObject();</span>
<span class="fc" id="L38">    }</span>

    /**
     * Retourne l'objet JSON de la classe.
     *
     * @return Le contenu du 'inputFile' chargé dqns le JSONObject.
     */
    public JSONObject getJsonObject() {
<span class="fc" id="L46">        return jsonObject;</span>
    }

    /**
     * Cette méthode valide et convertie un fichier JSON, identifiable par son chemin, vers un JSONObject manipulable
     *  @throws Groupe6INF2050Exception Ramène une exception si une erreur est trouvée
     */

    public void loadAndValid() throws Groupe6INF2050Exception {
        try {
<span class="fc" id="L56">            this.jsonObject = (JSONObject) JSONSerializer.toJSON(IOUtils.toString(new FileInputStream(inputFile), StandardCharsets.UTF_8));</span>
<span class="fc" id="L57">        } catch (FileNotFoundException e) {</span>
<span class="fc" id="L58">            throw new Groupe6INF2050Exception(&quot;Le fichier n'existe pas&quot;);</span>
<span class="fc" id="L59">        } catch (JSONException e) {</span>
<span class="fc" id="L60">            throw new Groupe6INF2050Exception(&quot;Le fichier JSON n'est pas valide&quot;);</span>
<span class="nc" id="L61">        } catch (IOException e) {</span>
<span class="nc" id="L62">            throw new Groupe6INF2050Exception(&quot;Erreur de lecture du fichier JSON&quot;);</span>
<span class="fc" id="L63">        }</span>
<span class="fc" id="L64">    }</span>

    /**
     * Cette méthode écrit un fichier JSON de sortie à partir des érreurs stockées dans le ErrorHandler.
     * Elle rajoute une clé &quot;complet&quot; et lui attribue en valeur false, s'il y'a des erreurs et true s'il n'y en a pas
     * @param errorHandler L'objet ErrorHandler est injecté ici afin de pouvoir acceder au tableau d'erreurs
     *                     et l'écire dans le fichier de sortie
     *  @throws Groupe6INF2050Exception Elle ramène une exception si une IOException est trouvée  lors de l'écriture du fichier sortie
     */

    public void save(ErrorHandler errorHandler) throws Groupe6INF2050Exception {
<span class="fc" id="L75">        JSONObject jsonOutput = createJsonOutput(errorHandler);</span>
<span class="fc" id="L76">        writeToFile(jsonOutput);</span>
<span class="fc" id="L77">    }</span>

    /**
     * Crée un objet JSON contenant le statut de complétude et les erreurs.
     *
     * @param errorHandler L'objet ErrorHandler contenant les erreurs à valider.
     * @return Un JSONObject représentant le statut et les erreurs.
     */
    private JSONObject createJsonOutput(ErrorHandler errorHandler) {
<span class="fc" id="L86">        JSONObject jsonOutput = new JSONObject();</span>
<span class="fc" id="L87">        jsonOutput.put(&quot;complet&quot;, errorHandler.hasErrors());</span>
<span class="fc" id="L88">        JSONArray jsonErrors = new JSONArray();</span>
<span class="fc" id="L89">        jsonErrors.addAll(errorHandler.getErrors());</span>
<span class="fc" id="L90">        jsonOutput.put(&quot;errors&quot;, jsonErrors);</span>
<span class="fc" id="L91">        return jsonOutput;</span>
    }

    /**
     * Écrit l'objet JSON dans un fichier.
     *
     * @param jsonOutput L'objet JSON à écrire dans le fichier.
     * @throws Groupe6INF2050Exception En cas d'erreur lors de l'écriture du fichier.
     */
    private void writeToFile(JSONObject jsonOutput) throws Groupe6INF2050Exception {
<span class="fc" id="L101">        try (FileWriter f = new FileWriter(outputFile)) {</span>
<span class="fc" id="L102">            f.write(jsonOutput.toString(4) + &quot;\t\n&quot;);</span>
<span class="fc" id="L103">            f.flush();</span>
<span class="nc" id="L104">        } catch (IOException e) {</span>
<span class="nc" id="L105">            throw new Groupe6INF2050Exception(&quot;Erreur lors de la sauvegarde du fichier : &quot; + e.getMessage());</span>
<span class="fc" id="L106">        }</span>
<span class="fc" id="L107">    }</span>



}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>