<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApplicationRunner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">inf2050-a24-projet-equipe6</a> &gt; <a href="index.source.html" class="el_package">GROUPE6_INF2050.Handlers</a> &gt; <span class="el_source">ApplicationRunner.java</span></div><h1>ApplicationRunner.java</h1><pre class="source lang-java linenums">package GROUPE6_INF2050.Handlers;

import GROUPE6_INF2050.Exceptions.Groupe6INF2050Exception;
import GROUPE6_INF2050.Reporting.StatisticsData;
import GROUPE6_INF2050.Utilities.FileTypeDetermine;
import GROUPE6_INF2050.Utilities.JsonFileUtility;
import GROUPE6_INF2050.Utilities.StatisticsFileManager;

import java.io.IOException;

public class ApplicationRunner {

    private final StatisticsFileManager statisticsFileManager;
    private StatisticsData statisticsData;
    private String option;

<span class="nc" id="L17">    public ApplicationRunner() {</span>
<span class="nc" id="L18">        this.statisticsFileManager = new StatisticsFileManager();</span>
<span class="nc" id="L19">    }</span>

<span class="fc" id="L21">    public ApplicationRunner(StatisticsFileManager statisticsFileManager) {</span>
<span class="fc" id="L22">        this.statisticsFileManager = statisticsFileManager;</span>
<span class="fc" id="L23">    }</span>

    public void run(String[] args) throws IOException {
<span class="fc" id="L26">        validateArguments(args);</span>
<span class="fc" id="L27">        initialize();</span>
<span class="fc" id="L28">        blockTryCatchForMainArgs(args);</span>
<span class="fc" id="L29">    }</span>

    private void blockTryCatchForMainArgs(String[] args) {
        try {
<span class="fc" id="L33">            processInputFile(args);</span>
<span class="nc" id="L34">        } catch (IOException e) {</span>
<span class="nc" id="L35">            System.err.println(&quot;Erreur d'entrée/sortie : &quot; + e.getMessage());</span>
<span class="nc" id="L36">        } catch (Groupe6INF2050Exception e) {</span>
<span class="nc" id="L37">            System.err.println(&quot;Erreur de validation : &quot; + e.getMessage());</span>
        } finally {
<span class="fc" id="L39">            finalizeActions();</span>
        }
<span class="fc" id="L41">    }</span>

    private void validateArguments(String[] args) {
<span class="fc bfc" id="L44" title="All 2 branches covered.">        if (args.length == 1) {</span>
<span class="fc bfc" id="L45" title="All 4 branches covered.">            if (!args[0].equals(&quot;-S&quot;) &amp;&amp; !args[0].equals(&quot;-SR&quot;)) {</span>
<span class="fc" id="L46">                throw new IllegalArgumentException(&quot;Option invalide. Utilisez '-S' ou '-SR' uniquement lorsque vous fournissez un seul argument.&quot;);</span>
            }
<span class="fc" id="L48">            option = args[0];</span>
<span class="pc bpc" id="L49" title="1 of 2 branches missed.">        } else if (args.length == 2) {</span>
<span class="pc bpc" id="L50" title="2 of 4 branches missed.">            if (args[0].isEmpty() || args[1].isEmpty()) {</span>
<span class="nc" id="L51">                throw new IllegalArgumentException(&quot;Les fichiers d'entrée et de sortie ne doivent pas être vides.&quot;);</span>
            }
        } else {
<span class="nc" id="L54">            throw new IllegalArgumentException(&quot;Nombre d'arguments invalide. Utilisez 1 argument ('-S' ou '-SR') ou 2 arguments pour spécifier des fichiers d'entrée et de sortie.&quot;);</span>
        }
<span class="fc" id="L56">    }</span>

    private void initialize() throws IOException {
<span class="fc" id="L59">        statisticsData = statisticsFileManager.loadStatistics();</span>
<span class="fc" id="L60">    }</span>

    private void processInputFile(String[] args) throws IOException, Groupe6INF2050Exception {
<span class="fc bfc" id="L63" title="All 4 branches covered.">        if (args[0].equals(&quot;-S&quot;) || args[0].equals(&quot;-SR&quot;)) {</span>
<span class="fc" id="L64">            return;</span>
        }

<span class="fc" id="L67">        String fileType = new FileTypeDetermine().determineFileType(args[0]);</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">        if (&quot;application/json&quot;.equals(fileType)) {</span>
<span class="fc" id="L69">            processJsonFile(args);</span>
        } else {
<span class="fc" id="L71">            System.out.println(&quot;Type de fichier non pris en charge : &quot; + fileType);</span>
        }
<span class="fc" id="L73">    }</span>

    private void processJsonFile(String[] args) throws IOException, Groupe6INF2050Exception {
<span class="fc" id="L76">        JsonFileUtility jsonFileUtility = new JsonFileUtility(args[0], args[1]);</span>
<span class="fc" id="L77">        HandleGeneralRulesValidator generalRulesValidator = new HandleGeneralRulesValidator(statisticsFileManager);</span>
<span class="fc" id="L78">        JsonHandler jsonHandler = new JsonHandler(generalRulesValidator);</span>
<span class="fc" id="L79">        jsonHandler.handleJson(jsonFileUtility, statisticsData);</span>
<span class="fc" id="L80">    }</span>

    private void finalizeActions() {
<span class="fc" id="L83">        saveStatistics();</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">        if (&quot;-SR&quot;.equals(option)) {</span>
<span class="fc" id="L85">            resetStatistics();</span>
<span class="fc bfc" id="L86" title="All 2 branches covered.">        } else if (&quot;-S&quot;.equals(option)) {</span>
<span class="fc" id="L87">            displayStatistics();</span>
        }
<span class="fc" id="L89">    }</span>

    private void saveStatistics() {
        try {
<span class="pc bpc" id="L93" title="2 of 4 branches missed.">            if (statisticsFileManager != null &amp;&amp; statisticsData != null) {</span>
<span class="fc" id="L94">                statisticsFileManager.saveStatistics(statisticsData);</span>
            }
<span class="nc" id="L96">        } catch (IOException e) {</span>
<span class="nc" id="L97">            System.err.println(&quot;Erreur lors de la sauvegarde des statistiques : &quot; + e.getMessage());</span>
<span class="fc" id="L98">        }</span>
<span class="fc" id="L99">    }</span>

    private void resetStatistics() {
        try {
<span class="fc" id="L103">            statisticsData.reset();</span>
<span class="fc" id="L104">            statisticsFileManager.saveStatistics(statisticsData);</span>
<span class="fc" id="L105">            System.out.println(&quot;Statistiques réinitialisées.&quot;);</span>
<span class="nc" id="L106">        } catch (IOException e) {</span>
<span class="nc" id="L107">            System.err.println(&quot;Erreur lors de la réinitialisation des statistiques : &quot; + e.getMessage());</span>
<span class="fc" id="L108">        }</span>
<span class="fc" id="L109">    }</span>

    private void displayStatistics() {
<span class="fc" id="L112">        System.out.println(&quot;Statistiques finales :&quot;);</span>
<span class="fc" id="L113">        System.out.println(statisticsData);</span>
<span class="fc" id="L114">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>